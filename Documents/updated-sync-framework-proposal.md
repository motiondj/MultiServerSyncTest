# 언리얼 엔진 다중 서버 동기화 프레임워크 개발 계획서

## 1. 개요

본 프레임워크는 언리얼 엔진으로 제작된 동일한 프로젝트를 다수의 서버에서 실행할 때 정밀한 동기화를 제공하는 네트워크 기반 플러그인입니다. 하드웨어 젠락(Quadro Sync) 유무에 관계없이 작동하며, 인터랙티브 콘텐츠의 프레임 단위 동기화를 목표로 합니다.

### 1.1 핵심 원칙: 단일 프로젝트, 다중 서버

본 프레임워크의 핵심 원칙은 **하나의 동일한 프로젝트**가 여러 서버에서 실행되더라도 통합된 단일 경험으로 작동하는 것입니다. nDisplay와 유사하게 하나의 설정으로 여러 서버를 제어하지만, 더 유연하고 하드웨어 의존성이 낮은 접근 방식을 제공합니다. 각 서버는 동일한 언리얼 프로젝트의 인스턴스를 실행하며, 이들은 함께 작동하여 통합된 하나의 시스템처럼 동작합니다.

### 1.2 개발 현황 요약

현재까지 다음 주요 기능이 구현되었습니다:
- 환경 감지 시스템 (하드웨어 젠락, nDisplay, 네트워크 인터페이스)
- 기본 네트워크 통신 시스템 (UDP 기반)
- PTP(Precision Time Protocol) 기반 시간 동기화
- 소프트웨어 PLL 구현
- 프레임 동기화 기본 구현
- 마스터-슬레이브 프로토콜 (선출 알고리즘, 역할 전환, 장애 복구)

## 2. 기술적 접근 방식

### 2.1 동기화 전략

#### 하드웨어 젠락 존재 시
- 하드웨어 젠락(Quadro Sync)을 기본 동기화 계층으로 활용
- 소프트웨어 동기화로 애플리케이션 로직 레벨에서 보완
- 하드웨어 젠락 신호와 소프트웨어 타이밍 통합

#### 하드웨어 젠락 부재 시
- PTP(Precision Time Protocol) 기반 정밀 시간 동기화
- 소프트웨어 PLL(Phase-Locked Loop) 알고리즘으로 지속적인 미세 조정
- 프레임 버퍼링 및 예측 알고리즘으로 네트워크 지연 보상

### 2.2 네트워크 아키텍처

- 마스터-슬레이브 구조 채택
- 마스터 서버 장애 시 자동 페일오버 메커니즘
- 우선순위 기반 마스터 선출 알고리즘
- UDP 기반 메시지 전송으로 오버헤드 최소화

### 2.3 주요 기술 구성요소

1. **PTP 구현** (구현 완료)
   - IEEE 1588 표준 기반 구현
   - 소프트웨어 타임스탬핑 지원
   - 네트워크 경로 지연 측정 및 보정
   - 시간 오프셋 계산 및 적용

2. **소프트웨어 PLL** (구현 완료)
   - 적응형 필터링 알고리즘
   - 클록 드리프트 예측 및 보정
   - 점진적 조정으로 시각적 깨짐 방지
   - 이상치 감지 및 처리

3. **프레임 동기화 엔진** (기본 구현 완료)
   - 프레임 타임스탬핑 및 시퀀스 번호 부여
   - 렌더링 및 프레젠테이션 타이밍 제어
   - 다중 GPU 환경 지원

4. **마스터-슬레이브 프로토콜** (구현 완료)
   - 우선순위 기반 마스터 선출 알고리즘
   - 자동 장애 감지 및 복구
   - 역할 전환 메커니즘
   - 주기적 상태 관리

5. **nDisplay 통합** (계획 단계)
   - nDisplay 존재 감지 및 자동 통합
   - nDisplay 없을 때 대체 기능 제공
   - nDisplay 클러스터 동기화 활용 및 확장

## 3. 시스템 아키텍처

```
┌────────────────────────────────────────────────────┐
│              동기화 프레임워크 플러그인             │
├──────────────┬─────────────────┬──────────────────┤
│  환경 감지    │  동기화 엔진     │  모니터링 시스템  │
├──────────────┼─────────────────┼──────────────────┤
│ - 젠락 감지   │ - PTP 클라이언트│ - 성능 측정       │
│ - nDisplay 감지│ - 소프트웨어 PLL│ - 시각화 도구     │
│ - 네트워크 분석│ - 프레임 동기화  │ - 진단 로깅       │
└──────────────┴─────────────────┴──────────────────┘
          │               │                │
┌─────────▼───────┐ ┌─────▼─────┐ ┌───────▼────────┐
│ 언리얼 엔진 통합  │ │ 네트워크   │ │ 사용자 인터페이스│
└───────────────────┘ └───────────┘ └─────────────────┘
```

### 3.1 핵심 클래스 구조

- **FSyncFrameworkManager**: 플러그인 메인 클래스, 전체 동기화 프로세스 관리 (구현 완료)
- **FEnvironmentDetector**: 하드웨어 및 소프트웨어 환경 감지 (구현 완료)
- **FNetworkManager**: 네트워크 통신 및 마스터-슬레이브 프로토콜 관리 (구현 완료)
- **FPTPClient**: PTP 프로토콜 구현 클래스 (구현 완료)
- **FSoftwarePLL**: 소프트웨어 PLL 알고리즘 구현 (구현 완료)
- **FTimeSync**: 시간 동기화 및 관련 구성요소 통합 관리 (구현 완료)
- **FFrameSyncController**: 프레임 렌더링 및 프레젠테이션 동기화 제어 (기본 구현 완료)
- **FSyncMonitor**: 동기화 성능 모니터링 및 진단 (계획 단계)

## 4. 개발 로드맵

### 4.1 1단계: 기반 시스템 개발 (완료)
- 기본 플러그인 구조 및 모듈 설계
- 언리얼 엔진 통합 기반 작업
- 로깅 및 디버깅 시스템 구축

### 4.2 2단계: 환경 감지 및 네트워크 통신 (완료)
- 환경 감지 시스템 구현 (하드웨어 젠락, nDisplay)
- 네트워크 인터페이스 탐색 및 구성
- UDP 기반 기본 통신 시스템 구현
- 서버 탐색 메커니즘 구현

### 4.3 3단계: 시간 동기화 기능 구현 (완료)
- PTP 기반 시간 동기화 구현
- 소프트웨어 PLL 알고리즘 구현
- 기본 프레임 동기화 메커니즘 구현
- 모듈 간 통합 및 테스트

### 4.4 4단계: 마스터-슬레이브 프로토콜 및 고급 기능 (진행 중)
- 마스터-슬레이브 프로토콜 구현 (완료)
- 네트워크 지연 측정 및 분석 (진행 예정)
- 신뢰성 있는 메시지 전달 보장 (진행 예정)
- 단일 프로젝트 설정 공유 시스템 (진행 예정)

### 4.5 5단계: 고급 프레임 동기화 및 렌더링 통합 (계획)
- 프레임 버퍼링 시스템 구현
- GPU 명령 제출 타이밍 제어
- nDisplay 통합 (선택적)
- 물리 시뮬레이션 동기화

### 4.6 6단계: 사용자 인터페이스 및 최적화 (계획)
- 동기화 모니터링 UI 개발
- 설정 및 구성 인터페이스 개발
- 성능 최적화
- 다양한 환경 테스트 및 안정화

### 4.7 7단계: 배포 준비 및 최종 테스트 (계획)
- 문서화 및 사용자 가이드 작성
- 설치 패키지 생성
- 다양한 환경에서의 테스트
- 공개 릴리스 또는 제한된 베타 릴리스

## 5. 기술적 고려사항

### 5.1 네트워크 성능
- 최소 요구 네트워크 대역폭: 100Mbps
- 권장 네트워크 구성: 기가비트 이더넷, 낮은 지연의 스위치
- 타임스탬프 해상도: 마이크로초(μs) 수준
- 패킷 우선순위 설정으로 동기화 트래픽 보호

### 5.2 시간 정밀도
- PTP 목표 정밀도: 100μs 이내
- 소프트웨어 PLL 목표 정밀도: 1ms 이내
- 프레임 타이밍 동기화 목표: 1 프레임 이내(60fps에서 16.6ms)
- 하드웨어 젠락 환경 목표 정밀도: 100μs 이내

### 5.3 시스템 요구사항
- CPU: 4코어 이상 권장(동기화 알고리즘용 추가 스레드)
- 메모리: 기본 언리얼 엔진 요구사항 + 200MB
- 네트워크: 1Gbps 이더넷 권장
- 운영체제: Windows 10/11, Linux(Ubuntu 20.04 이상)

## 6. 확장성 및 미래 방향

### 6.1 확장 가능성
- 타임코드 기반 이벤트 시스템과 통합
- 외부 방송 장비와의 동기화 연동
- 모션 캡처 시스템과의 통합
- 대규모 다중 노드 환경으로 확장

### 6.2 향후 개발 방향
- 기계학습 기반 네트워크 지연 예측
- 분산 렌더링 환경에서의 활용
- 클라우드 기반 다중 노드 지원
- VR/AR/XR 환경에서의 다중 장치 동기화

## 7. 현재 개발 진행상황

단계 4까지 개발이 진행되었으며, 현재 다음 기능들이 구현 완료되었습니다:

1. **환경 감지 시스템**
   - 하드웨어 젠락(Quadro Sync) 감지
   - nDisplay 모듈 감지
   - 네트워크 인터페이스 탐색 및 정보 수집

2. **네트워크 통신 시스템**
   - UDP 소켓 통신 기본 클래스
   - 메시지 송수신 기능
   - 서버 탐색 메커니즘
   - 프로젝트 식별 시스템

3. **시간 동기화 시스템**
   - PTP 메시지 구조 및 처리 로직
   - 시간 오프셋 계산 및 적용
   - 소프트웨어 PLL 알고리즘
   - 클록 조정 및 안정화 메커니즘

4. **프레임 동기화 시스템**
   - 프레임 카운터 구현
   - 프레임 타이밍 조정 메커니즘
   - 엔진 틱 후킹

5. **마스터-슬레이브 프로토콜**
   - 마스터 선출 알고리즘
   - 역할 전환 메커니즘
   - 장애 감지 및 복구
   - 주기적 상태 관리

## 8. 결론

본 개발 계획서는 언리얼 엔진 기반 프로젝트의 다중 서버 환경에서 정밀한 동기화를 제공하는 프레임워크의 구현 방안과 진행 상황을 제시합니다. 현재까지 마스터-슬레이브 프로토콜까지 구현이 완료되었으며, 다음 단계로 네트워크 지연 측정 및 분석, 신뢰성 있는 메시지 전달 보장, 단일 프로젝트 설정 공유 시스템 등을 구현할 예정입니다.

이 프레임워크는 특히 공연, 미디어 파사드, 가상 제작, 다중 프로젝터 환경 등 여러 서버에서 동일한 언리얼 엔진 프로젝트를 실행해야 하는 환경에 적합합니다.