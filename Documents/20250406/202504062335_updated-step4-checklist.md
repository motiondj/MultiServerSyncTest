# 단계 4: 마스터-슬레이브 프로토콜 및 고급 기능 개발 (4-5주)

## 모듈 2 확장: 고급 네트워크 기능

### 1. 마스터-슬레이브 프로토콜 구현
- [x] 마스터-슬레이브 메시지 타입 정의
  - [x] MasterAnnouncement - 마스터가 자신의 상태를 알림
  - [x] MasterQuery - 마스터 정보 요청
  - [x] MasterResponse - 마스터 정보 응답
  - [x] MasterElection - 마스터 선출 시작
  - [x] MasterVote - 마스터 선출 투표
  - [x] MasterResign - 마스터 사임 알림
  - [x] RoleChange - 역할 변경 알림

- [x] 마스터 선출 알고리즘 구현
  - [x] 선출 시작 메커니즘 (StartMasterElection)
  - [x] 우선순위 기반 투표 시스템 (CalculateVotePriority)
  - [x] 투표 결과 처리 및 마스터 결정 (TryBecomeMaster)
  - [x] 선출 타임아웃 처리 (ELECTION_TIMEOUT_SECONDS)

- [x] 역할 전환 메커니즘 구현
  - [x] 마스터 상태 공지 (AnnounceMaster)
  - [x] 마스터 사임 처리 (ResignMaster)
  - [x] 역할 변경 알림 (UpdateMasterStatus, SendRoleChangeNotification)

- [x] 메시지 처리기 구현
  - [x] HandleMasterAnnouncement - 마스터 공지 메시지 처리
  - [x] HandleMasterQuery - 마스터 정보 요청 처리
  - [x] HandleMasterResponse - 마스터 정보 응답 처리
  - [x] HandleMasterElection - 마스터 선출 메시지 처리
  - [x] HandleMasterVote - 마스터 투표 메시지 처리
  - [x] HandleMasterResign - 마스터 사임 메시지 처리
  - [x] HandleRoleChange - 역할 변경 메시지 처리

- [x] 정기적인 상태 관리 구현
  - [x] 마스터 타임아웃 체크 (CheckMasterTimeout)
  - [x] 주기적 마스터 공지 (TickMasterSlaveProtocol)
  - [x] 틱 기능 연결 (MasterSlaveProtocolTick)

### 2. 단일 프로젝트 설정 공유 시스템
- [x] 전역 설정 구조체 정의
  - [x] FProjectSettings 클래스 생성
  - [x] 마스터-슬레이브, 시간 동기화, 프레임 동기화, 네트워크 설정 포함
  - [x] 기본값 설정 및 생성자 구현
  
- [x] 설정 직렬화/역직렬화 기능
  - [x] FArchive를 이용한 바이너리 직렬화 구현
  - [x] ToBytes와 FromBytes 유틸리티 메서드 구현
  - [x] JSON 기반 파일 저장/로드 기능 구현
  
- [x] 설정 관리자 클래스 구현
  - [x] FSettingsManager 클래스 생성
  - [x] 설정 업데이트 메서드 구현
  - [x] 설정 변경 이벤트 처리기 등록 메커니즘
  - [x] 설정 유효성 검사 로직 구현
  
- [x] 설정 동기화 네트워크 메시지 타입 추가
  - [x] SettingsSync - 설정 동기화 메시지
  - [x] SettingsRequest - 설정 요청 메시지
  - [x] SettingsResponse - 설정 응답 메시지
  
- [x] 마스터 설정 변경 실시간 전파
  - [x] 마스터에서 설정 변경 시 브로드캐스트
  - [x] 슬레이브에서 설정 받기 및 적용
  - [x] 설정 버전 관리 (SettingsVersion)
  
- [x] 설정 충돌 해결 메커니즘
  - [x] 버전 기반 충돌 감지
  - [x] 마스터 설정 우선 원칙 적용
  - [x] 설정 변경 로깅 및 모니터링

### 3. 네트워크 지연 측정 및 분석
- [ ] 왕복 시간(RTT) 측정 구현
  - [ ] 핑 메시지 타입 정의
  - [ ] 핑 요청/응답 메커니즘 구현
  - [ ] 타임스탬프 기반 RTT 계산

- [ ] 지연 통계 수집 및 분석
  - [ ] 최소/최대/평균 지연 계산
  - [ ] 표준 편차 및 지터 분석
  - [ ] 통계 데이터 저장 및 관리

- [ ] 네트워크 상태 정보 제공
  - [ ] 상태 보고 클래스 구현
  - [ ] 실시간 네트워크 품질 지표 계산
  - [ ] 네트워크 품질에 따른 동작 조정

### 4. 신뢰성 있는 메시지 전달 보장
- [ ] 메시지 확인 및 재전송 메커니즘
  - [ ] ACK 메시지 타입 정의
  - [ ] 타임아웃 기반 재전송 로직
  - [ ] 메시지 전송 상태 추적

- [ ] 메시지 시퀀스 관리
  - [ ] 메시지 시퀀스 번호 할당 및 관리
  - [ ] 메시지 순서 보장 알고리즘
  - [ ] 누락된 메시지 감지 및 요청

- [ ] 중복 메시지 처리
  - [ ] 중복 감지 로직 구현
  - [ ] 메시지 캐싱 메커니즘
  - [ ] 멱등성 보장 처리

## 모듈 3 확장: 고급 PTP 기능
- [ ] 완전한 PTP 상태 머신 구현
- [ ] 경로 지연 측정 및 보정
- [ ] 비대칭 지연 처리

## 모듈 4 확장: 고급 PLL 기능
- [ ] 적응형 필터링 알고리즘
- [ ] 클록 드리프트 예측 및 보정
- [ ] 이상치 감지 및 처리

## 테스트 및 검증
- [x] 마스터-슬레이브 프로토콜 테스트
  - [x] 마스터 선출 과정 검증
  - [x] 역할 전환 정확성 확인
  - [x] 메시지 처리 로직 검증

- [x] 단일 프로젝트 설정 공유 테스트
  - [x] 설정 직렬화/역직렬화 검증
  - [x] 설정 전파 확인
  - [x] 설정 충돌 해결 확인

- [ ] 마스터 장애 시 페일오버 테스트
  - [ ] 마스터 강제 종료 시나리오
  - [ ] 네트워크 단절 시나리오
  - [ ] 부하 테스트

- [ ] 다양한 네트워크 조건에서의 동기화 정확도 테스트
  - [ ] 높은 지연 환경 테스트
  - [ ] 패킷 손실 시나리오 테스트
  - [ ] 가변 대역폭 테스트

- [ ] 장시간 실행 안정성 테스트
  - [ ] 24시간 연속 작동 테스트
  - [ ] 메모리 누수 검사
  - [ ] 오류 복구 검증

- [ ] 성능 최적화 및 CPU 사용량 분석
  - [ ] CPU 프로파일링
  - [ ] 메모리 사용량 분석
  - [ ] 네트워크 트래픽 측정

## 구현된 주요 기능
1. **마스터-슬레이브 프로토콜**: 여러 서버 간 마스터 선출 및 역할 관리 시스템
2. **단일 프로젝트 설정 공유 시스템**: 모든 서버에 일관된 설정을 유지하기 위한 시스템

## 다음 작업 계획
1. 네트워크 지연 측정 및 분석 구현
2. 신뢰성 있는 메시지 전달 보장 메커니즘 개발
3. 테스트 케이스 확장 및 추가 검증