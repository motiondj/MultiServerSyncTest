# 왕복 시간(RTT) 측정 고급화 및 네트워크 상태 평가 고도화 진행 상황

## 단계 4: 마스터-슬레이브 프로토콜 및 고급 기능 개발 (4-5주)

### 모듈 2 확장: 고급 네트워크 기능

#### 3. 네트워크 지연 측정 및 분석 진행 상황
- [x] 기본 측정 메커니즘 구현
  - [x] FPingMessage 구조체 정의
  - [x] 핑 요청/응답 메시지 타입 정의
  - [x] 메시지 직렬화/역직렬화 함수 구현
- [x] 핑 메시지 처리 시스템
  - [x] SendPingRequest/SendPingResponse 함수 구현
  - [x] HandlePingRequest/HandlePingResponse 메서드 구현
  - [x] 시퀀스 번호 기반 요청-응답 매칭
  - [x] 대기 중인 핑 요청 관리
- [x] 지연 통계 기초 구현
  - [x] FNetworkLatencyStats 구조체 정의
  - [x] RTT 샘플 추가 및 기본 통계 계산 구현
  - [x] 표준 편차 및 지터 계산 알고리즘 구현
  - [x] 통계 저장 및 관리 기본 구조 구현
- [x] BP 인터페이스 구현
  - [x] 지연 측정 시작/중지 함수
  - [x] 통계 조회 함수
  - [x] 네트워크 품질 평가 함수
- [x] 네트워크 지연 테스터 컴포넌트
  - [x] BP_NetworkLatencyTester 액터 컴포넌트 구현
  - [x] 자동 측정 및 통계 표시 기능
- [✓] **왕복 시간(RTT) 측정 고급화** (완료)
  - [✓] 고정밀 타임스탬프 사용 개선
    - [✓] GetHighPrecisionTimestamp 메서드 구현
    - [✓] 하드웨어 타이머 사용한 타임스탬프 생성
  - [✓] 하드웨어 시간 지원 구현
    - [✓] 하드웨어 타이머 보정 메서드 구현
    - [✓] UTC 시간 변환 기능 구현
  - [✓] 동적 샘플링 레이트 적용
    - [✓] 네트워크 상태에 따른 샘플링 간격 자동 조정
    - [✓] 연속 타임아웃 감지 및 처리
    - [✓] 품질 계수 기반 샘플링 레이트 계산
  - [✓] **고급 지연 통계 및 분석** (완료)
    - [✓] 백분위수(percentile) 통계 추가 (50%, 95%, 99%)
    - [✓] 이상치(outlier) 식별 및 필터링
    - [✓] 시간대별 통계 및 추세 분석
  - [✓] **네트워크 상태 평가 고도화** (완료)
    - [✓] 멀티 메트릭 기반 품질 평가 알고리즘
      - [✓] FNetworkQualityAssessment 구조체 정의
      - [✓] 지연 시간, 지터, 패킷 손실, 안정성 기반 종합 평가
      - [✓] 점수 계산 알고리즘 (0-100) 구현
      - [✓] 상세 설명 및 권장 사항 생성
    - [✓] 네트워크 상태 변화 감지 및 알림
      - [✓] ENetworkEventType 열거형 정의
      - [✓] 상태 변화 감지 로직 구현
      - [✓] 이벤트 핸들러 및 로깅 구현
    - [✓] 블루프린트 인터페이스 확장
      - [✓] 고급 품질 평가 BP 함수 추가
      - [✓] 이벤트 모니터링 제어 함수 추가
      - [✓] 성능 임계값 설정 함수 추가
    - [✓] BP_NetworkLatencyTester 컴포넌트 업데이트
      - [✓] 새로운 품질 지표 표시 기능 추가
      - [✓] 사용자 정의 성능 임계값 설정 기능
      - [✓] 이벤트 모니터링 및 표시 기능

#### 4. 신뢰성 있는 메시지 전달 보장
- [x] 기본 메시지 시퀀스 관리
  - [x] 시퀀스 번호 생성 및 관리 기능
  - [x] 메시지 헤더에 시퀀스 정보 포함
- [ ] 메시지 확인 및 재전송 메커니즘
  - [ ] ACK 메시지 타입 정의
  - [ ] 타임아웃 기반 재전송 로직
  - [ ] 메시지 전송 상태 추적
- [ ] 고급 메시지 시퀀스 관리
  - [ ] 순서 보장 알고리즘 구현
  - [ ] 누락된 메시지 감지 및 요청
  - [ ] 시퀀스 윈도우 관리
- [ ] 중복 메시지 처리
  - [ ] 중복 감지 로직 구현
  - [ ] 메시지 캐싱 메커니즘
  - [ ] 멱등성 보장 처리

## 구현 중 발생한 문제점 및 해결 방법

### 1. 변수 재정의 오류
- **문제**: `HardwareTimerInitTime` 변수가 중복 선언되어 컴파일 오류 발생
- **원인**: 동일한 변수를 여러 번 선언했거나, 이전 코드 변경에서 이미 추가된 변수를 다시 추가했을 가능성
- **해결 방법**: FNetworkManager.h 파일에서 중복 선언을 확인하고 제거

### 2. 동적 샘플링 관련 문제
- **문제**: 네트워크 상태에 따라 과도하게 빠른 샘플링 또는 과도하게 느린 샘플링이 발생할 가능성
- **해결 방법**: 최소/최대 샘플링 간격을 설정하고, 점진적인 변화를 위한 평활화 로직 추가

### 3. 인터페이스 구현 누락 문제
- **문제**: ModuleInterfaces.h에서 새 인터페이스 메서드 선언이 누락되어 컴파일 오류 발생
- **해결 방법**: INetworkManager 인터페이스에 모든 새 메서드를 추가하고 FNetworkManager에서 구현

### 4. 로깅 카테고리 참조 오류
- **문제**: NetworkTypes.cpp에서 LogMultiServerSync 로깅 카테고리를 인식하지 못함
- **해결 방법**: FSyncLog.h 헤더 파일을 포함하여 로깅 카테고리에 접근 가능하게 함

### 5. 중복 메서드 선언 오류
- **문제**: FNetworkManager.h 파일에서 일부 메서드가 중복 선언되어 컴파일 오류 발생
- **해결 방법**: 중복 선언된 메서드들(SetOutlierFiltering, GetOutlierStats 등)을 제거

### 6. 변수 이름 충돌 오류
- **문제**: 'Port'라는 로컬 변수가 클래스 멤버 변수를 가리는 오류 발생
- **해결 방법**: 로컬 변수 이름을 'PortNumber'로 변경하여 클래스 멤버와 구분

## 다음 구현 계획

1. **메시지 확인 및 재전송 메커니즘 구현**
   - ACK 메시지 타입 정의
   - 타임아웃 기반 재전송 로직
   - 메시지 전송 상태 추적
   
2. **고급 메시지 시퀀스 관리 구현**
   - 순서 보장 알고리즘
   - 누락된 메시지 감지 및 요청
   - 시퀀스 윈도우 관리
   
3. **중복 메시지 처리 구현**
   - 중복 감지 로직
   - 메시지 캐싱 메커니즘
   - 멱등성 보장 처리