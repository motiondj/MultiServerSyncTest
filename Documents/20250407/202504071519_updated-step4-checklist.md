# 단계 4: 마스터-슬레이브 프로토콜 및 고급 기능 개발 (4-5주)

## 모듈 2 확장: 고급 네트워크 기능

### 1. 마스터-슬레이브 프로토콜 구현
- [x] 마스터-슬레이브 메시지 타입 정의
  - [x] MasterAnnouncement - 마스터가 자신의 상태를 알림
  - [x] MasterQuery - 마스터 정보 요청
  - [x] MasterResponse - 마스터 정보 응답
  - [x] MasterElection - 마스터 선출 시작
  - [x] MasterVote - 마스터 선출 투표
  - [x] MasterResign - 마스터 사임 알림
  - [x] RoleChange - 역할 변경 알림

- [x] 마스터 선출 알고리즘 구현
  - [x] 선출 시작 메커니즘 (StartMasterElection)
  - [x] 우선순위 기반 투표 시스템 (CalculateVotePriority)
  - [x] 투표 결과 처리 및 마스터 결정 (TryBecomeMaster)
  - [x] 선출 타임아웃 처리 (ELECTION_TIMEOUT_SECONDS)

- [x] 역할 전환 메커니즘 구현
  - [x] 마스터 상태 공지 (AnnounceMaster)
  - [x] 마스터 사임 처리 (ResignMaster)
  - [x] 역할 변경 알림 (UpdateMasterStatus, SendRoleChangeNotification)

- [x] 메시지 처리기 구현
  - [x] HandleMasterAnnouncement - 마스터 공지 메시지 처리
  - [x] HandleMasterQuery - 마스터 정보 요청 처리
  - [x] HandleMasterResponse - 마스터 정보 응답 처리
  - [x] HandleMasterElection - 마스터 선출 메시지 처리
  - [x] HandleMasterVote - 마스터 투표 메시지 처리
  - [x] HandleMasterResign - 마스터 사임 메시지 처리
  - [x] HandleRoleChange - 역할 변경 메시지 처리

- [x] 정기적인 상태 관리 구현
  - [x] 마스터 타임아웃 체크 (CheckMasterTimeout)
  - [x] 주기적 마스터 공지 (TickMasterSlaveProtocol)
  - [x] 틱 기능 연결 (MasterSlaveProtocolTick)

### 2. 단일 프로젝트 설정 공유 시스템
- [x] 전역 설정 구조체 정의
  - [x] FProjectSettings 클래스 생성
  - [x] 마스터-슬레이브, 시간 동기화, 프레임 동기화, 네트워크 설정 포함
  - [x] 기본값 설정 및 생성자 구현
  
- [x] 설정 직렬화/역직렬화 기능
  - [x] FArchive를 이용한 바이너리 직렬화 구현
  - [x] ToBytes와 FromBytes 유틸리티 메서드 구현
  - [x] JSON 기반 파일 저장/로드 기능 구현
  
- [x] 설정 관리자 클래스 구현
  - [x] FSettingsManager 클래스 생성
  - [x] 설정 업데이트 메서드 구현
  - [x] 설정 변경 이벤트 처리기 등록 메커니즘
  - [x] 설정 유효성 검사 로직 구현
  
- [x] 설정 동기화 네트워크 메시지 타입 추가
  - [x] SettingsSync - 설정 동기화 메시지
  - [x] SettingsRequest - 설정 요청 메시지
  - [x] SettingsResponse - 설정 응답 메시지
  
- [x] 마스터 설정 변경 실시간 전파
  - [x] 마스터에서 설정 변경 시 브로드캐스트
  - [x] 슬레이브에서 설정 받기 및 적용
  - [x] 설정 버전 관리 (SettingsVersion)
  
- [x] 설정 충돌 해결 메커니즘
  - [x] 버전 기반 충돌 감지
  - [x] 마스터 설정 우선 원칙 적용
  - [x] 설정 변경 로깅 및 모니터링

### 3. 네트워크 지연 측정 및 분석
- [x] 기본 측정 메커니즘 구현
  - [x] FPingMessage 구조체 정의
  - [x] 핑 요청/응답 메시지 타입 정의
  - [x] 메시지 직렬화/역직렬화 함수 구현

- [x] 핑 메시지 처리 시스템
  - [x] SendPingRequest/SendPingResponse 함수 구현
  - [x] HandlePingRequest/HandlePingResponse 메서드 구현
  - [x] 시퀀스 번호 기반 요청-응답 매칭
  - [x] 대기 중인 핑 요청 관리

- [x] 지연 통계 기초 구현
  - [x] FNetworkLatencyStats 구조체 정의
  - [x] RTT 샘플 추가 및 기본 통계 계산 구현
  - [x] 표준 편차 및 지터 계산 알고리즘 구현
  - [x] 통계 저장 및 관리 기본 구조 구현

- [x] BP 인터페이스 구현
  - [x] 지연 측정 시작/중지 함수
  - [x] 통계 조회 함수
  - [x] 네트워크 품질 평가 함수

- [x] 네트워크 지연 테스터 컴포넌트
  - [x] BP_NetworkLatencyTester 액터 컴포넌트 구현
  - [x] 자동 측정 및 통계 표시 기능

- [ ] 왕복 시간(RTT) 측정 고급화
  - [ ] 고정밀 타임스탬프 사용 개선
  - [ ] 하드웨어 시간 지원 조사 및 구현
  - [ ] 동적 샘플링 레이트 적용

- [ ] 고급 지연 통계 및 분석
  - [ ] 백분위수(percentile) 통계 추가 (50%, 95%, 99%)
  - [ ] 이상치(outlier) 식별 및 필터링
  - [ ] 시간대별 통계 및 추세 분석

- [ ] 네트워크 상태 평가 고도화
  - [ ] 멀티 메트릭 기반 품질 평가 알고리즘
  - [ ] 네트워크 상태 변화 감지 및 알림
  - [ ] 네트워크 조건에 따른 시스템 자동 조정

### 4. 신뢰성 있는 메시지 전달 보장
- [x] 기본 메시지 시퀀스 관리
  - [x] 시퀀스 번호 생성 및 관리 기능
  - [x] 메시지 헤더에 시퀀스 정보 포함

- [ ] 메시지 확인 및 재전송 메커니즘
  - [ ] ACK 메시지 타입 정의
  - [ ] 타임아웃 기반 재전송 로직
  - [ ] 메시지 전송 상태 추적

- [ ] 고급 메시지 시퀀스 관리
  - [ ] 순서 보장 알고리즘 구현
  - [ ] 누락된 메시지 감지 및 요청
  - [ ] 시퀀스 윈도우 관리

- [ ] 중복 메시지 처리
  - [ ] 중복 감지 로직 구현
  - [ ] 메시지 캐싱 메커니즘
  - [ ] 멱등성 보장 처리

## 모듈 3 확장: 고급 PTP 기능
- [ ] 완전한 PTP 상태 머신 구현
  - [ ] IEEE 1588 규격 호환 상태 변환
  - [ ] 이벤트 기반 상태 전이 로직
  - [ ] 다양한 PTP 프로파일 지원

- [ ] 경로 지연 측정 및 보정
  - [ ] 양방향 및 단방향 경로 지연 측정
  - [ ] 비대칭 경로 감지 알고리즘
  - [ ] 지연 변동 보상 메커니즘

- [ ] 비대칭 지연 처리
  - [ ] 비대칭 네트워크 조건 감지
  - [ ] 비대칭 보정 알고리즘 구현
  - [ ] 보정 품질 모니터링

## 모듈 4 확장: 고급 PLL 기능
- [ ] 적응형 필터링 알고리즘
  - [ ] 칼만 필터 구현
  - [ ] 네트워크 조건에 따른 필터 파라미터 조정
  - [ ] 필터 성능 분석 및 최적화

- [ ] 클록 드리프트 예측 및 보정
  - [ ] 드리프트 예측 모델 구현
  - [ ] 온도 보상 알고리즘 조사
  - [ ] 장기 드리프트 추적 및 보정

- [ ] 이상치 감지 및 처리
  - [ ] 통계적 이상치 감지 알고리즘
  - [ ] 이상치 영향 최소화 전략
  - [ ] 이상 상황 복구 메커니즘

## 테스트 및 검증
- [x] 마스터-슬레이브 프로토콜 테스트
  - [x] 마스터 선출 과정 검증
  - [x] 역할 전환 정확성 확인
  - [x] 메시지 처리 로직 검증

- [x] 단일 프로젝트 설정 공유 테스트
  - [x] 설정 직렬화/역직렬화 검증
  - [x] 설정 전파 확인
  - [x] 설정 충돌 해결 확인

- [ ] 네트워크 지연 측정 테스트
  - [ ] 다양한 네트워크 환경에서 측정 정확도 검증
  - [ ] 통계 계산 정확성 검증
  - [ ] BP 인터페이스 기능 검증

- [ ] 마스터 장애 시 페일오버 테스트
  - [ ] 마스터 강제 종료 시나리오
  - [ ] 네트워크 단절 시나리오
  - [ ] 부하 테스트

- [ ] 다양한 네트워크 조건에서의 동기화 정확도 테스트
  - [ ] 높은 지연 환경 테스트
  - [ ] 패킷 손실 시나리오 테스트
  - [ ] 가변 대역폭 테스트

- [ ] 장시간 실행 안정성 테스트
  - [ ] 24시간 연속 작동 테스트
  - [ ] 메모리 누수 검사
  - [ ] 오류 복구 검증

- [ ] 성능 최적화 및 CPU 사용량 분석
  - [ ] CPU 프로파일링
  - [ ] 메모리 사용량 분석
  - [ ] 네트워크 트래픽 측정

## 구현된 주요 기능
1. **마스터-슬레이브 프로토콜**: 여러 서버 간 마스터 선출 및 역할 관리 시스템
2. **단일 프로젝트 설정 공유 시스템**: 모든 서버에 일관된 설정을 유지하기 위한 시스템
3. **기본 네트워크 지연 측정 시스템**: 서버 간 지연 시간 측정 및 기본 통계 수집

## 현재 진행 중인 작업
1. 네트워크 지연 측정 및 분석 고도화
2. 신뢰성 있는 메시지 전달 보장 메커니즘 개발
3. 테스트 케이스 확장 및 추가 검증

## 다음 작업 계획
1. 고급 PTP 기능 구현
2. 고급 PLL 기능 구현
3. 종합 테스트 및 성능 최적화