# 단계 4: 마스터-슬레이브 프로토콜 및 고급 기능 개발 (4-5주)

## 모듈 7: 마스터-슬레이브 프로토콜 고급화 ✅
- [x] 내결함성 개선
  - [x] 마스터 장애 복구
  - [x] 슬레이브 장애 감지
  - [x] 자동 재연결
- [x] 로드 밸런싱
  - [x] 마스터 부하 모니터링
  - [x] 동적 마스터 선출 우선순위
  - [x] 부하 분산 전략
- [x] 분산 합의 알고리즘
  - [x] 정족수 기반 의사 결정
  - [x] 상태 일관성 보장
  - [x] 갈등 해결
- [x] 블루프린트 인터페이스 확장
  - [x] 고급 제어 함수
  - [x] 상태 모니터링 확장
  - [x] 디버깅 확장

## 모듈 2 확장: 고급 네트워크 기능 ⏳
- [x] 설정 동기화
  - [x] 프로젝트 설정 구조 정의
  - [x] 설정 직렬화/역직렬화
  - [x] 네트워크를 통한 설정 공유
- [x] 설정 관리 시스템
  - [x] 로컬 설정 저장/로드
  - [x] 설정 변경 이벤트
  - [x] 유효성 검사
- [x] 네트워크 지연 측정 및 분석
  - [x] 기본 측정 메커니즘 구현
    - [x] FPingMessage 구조체 정의
    - [x] 핑 요청/응답 메시지 타입 정의
    - [x] 메시지 직렬화/역직렬화 함수 구현
  - [x] 핑 메시지 처리 시스템
    - [x] SendPingRequest/SendPingResponse 함수 구현
    - [x] HandlePingRequest/HandlePingResponse 메서드 구현
    - [x] 시퀀스 번호 기반 요청-응답 매칭
    - [x] 대기 중인 핑 요청 관리
  - [x] 지연 통계 기초 구현
    - [x] FNetworkLatencyStats 구조체 정의
    - [x] RTT 샘플 추가 및 기본 통계 계산 구현
    - [x] 표준 편차 및 지터 계산 알고리즘 구현
    - [x] 통계 저장 및 관리 기본 구조 구현
  - [x] BP 인터페이스 구현
    - [x] 지연 측정 시작/중지 함수
    - [x] 통계 조회 함수
    - [x] 네트워크 품질 평가 함수
  - [x] 네트워크 지연 테스터 컴포넌트
    - [x] BP_NetworkLatencyTester 액터 컴포넌트 구현
    - [x] 자동 측정 및 통계 표시 기능
  - [x] **왕복 시간(RTT) 측정 고급화** (완료)
    - [x] 고정밀 타임스탬프 사용 개선
      - [x] GetHighPrecisionTimestamp 메서드 구현
      - [x] 하드웨어 타이머 사용한 타임스탬프 생성
    - [x] 하드웨어 시간 지원 구현
      - [x] 하드웨어 타이머 보정 메서드 구현
      - [x] UTC 시간 변환 기능 구현
    - [x] 동적 샘플링 레이트 적용
      - [x] 네트워크 상태에 따른 샘플링 간격 자동 조정
      - [x] 연속 타임아웃 감지 및 처리
      - [x] 품질 계수 기반 샘플링 레이트 계산
    - [x] **고급 지연 통계 및 분석** (완료)
      - [x] 백분위수(percentile) 통계 추가 (50%, 95%, 99%)
      - [x] 이상치(outlier) 식별 및 필터링
      - [x] 시간대별 통계 및 추세 분석
    - [x] **네트워크 상태 평가 고도화** (완료)
      - [x] 멀티 메트릭 기반 품질 평가 알고리즘
        - [x] FNetworkQualityAssessment 구조체 정의
        - [x] 지연 시간, 지터, 패킷 손실, 안정성 기반 종합 평가
        - [x] 점수 계산 알고리즘 (0-100) 구현
        - [x] 상세 설명 및 권장 사항 생성
      - [x] 네트워크 상태 변화 감지 및 알림
        - [x] ENetworkEventType 열거형 정의
        - [x] 상태 변화 감지 로직 구현
        - [x] 이벤트 핸들러 및 로깅 구현
      - [x] 블루프린트 인터페이스 확장
        - [x] 고급 품질 평가 BP 함수 추가
        - [x] 이벤트 모니터링 제어 함수 추가
        - [x] 성능 임계값 설정 함수 추가
      - [x] BP_NetworkLatencyTester 컴포넌트 업데이트
        - [x] 새로운 품질 지표 표시 기능 추가
        - [x] 사용자 정의 성능 임계값 설정 기능
        - [x] 이벤트 모니터링 및 표시 기능
- [x] 신뢰성 있는 메시지 전달 보장
  - [x] 기본 메시지 시퀀스 관리
    - [x] 시퀀스 번호 생성 및 관리 기능
    - [x] 메시지 헤더에 시퀀스 정보 포함
  - [x] 메시지 확인 및 재전송 메커니즘
    - [x] ACK 메시지 타입 정의
    - [x] 타임아웃 기반 재전송 로직
    - [x] 메시지 전송 상태 추적
  - [ ] 고급 메시지 시퀀스 관리
    - [ ] 순서 보장 알고리즘 구현
    - [ ] 누락된 메시지 감지 및 요청
    - [ ] 시퀀스 윈도우 관리
  - [ ] 중복 메시지 처리
    - [ ] 중복 감지 로직 구현
    - [ ] 메시지 캐싱 메커니즘
    - [ ] 멱등성 보장 처리

## 발생한 문제점 및 해결 방법

### 1. 변수 재정의 오류
- **문제**: `HardwareTimerInitTime` 변수가 중복 선언되어 컴파일 오류 발생
- **원인**: 동일한 변수를 여러 번, 이전 코드에서 이미 선언된 변수를 다시 추가
- **해결 방법**: FNetworkManager.h 파일에서 중복 선언을 제거 - 해결 완료

### 2. 동적 샘플링 관련 문제
- **문제**: 네트워크 상태에 따라 과도하게 빠른/느린 샘플링 발생 가능성
- **해결 방법**: 최소/최대 샘플링 간격 설정, 점진적 변화를 위한 평활화 로직 추가 - 해결 완료

### 3. 인터페이스 구현 누락 문제
- **문제**: ModuleInterfaces.h에서 새 인터페이스 메서드 선언 누락으로 컴파일 오류
- **해결 방법**: INetworkManager 인터페이스에 모든 새 메서드 추가 및 구현 - 해결 완료

### 4. 로깅 카테고리 참조 오류
- **문제**: NetworkTypes.cpp에서 LogMultiServerSync 로깅 카테고리 인식 불가
- **해결 방법**: FSyncLog.h 헤더 파일 포함하여 로깅 카테고리 접근 가능하게 함 - 해결 완료

### 5. 중복 메서드 선언 오류
- **문제**: FNetworkManager.h 파일에서 일부 메서드 중복 선언으로 컴파일 오류
- **해결 방법**: SetOutlierFiltering, GetOutlierStats 등 중복 선언 메서드 제거 - 해결 완료

### 6. 변수 이름 충돌 오류
- **문제**: 'Port'라는 로컬 변수가 클래스 멤버 변수를 가리는 오류
- **해결 방법**: 로컬 변수명을 'PortNumber'로 변경하여 클래스 멤버와 구분 - 해결 완료

### 7. 메시지 재전송 구현 시 중복 코드 오류
- **문제**: 메시지 확인 및 재전송 메커니즘 구현 중 이미 존재하는 코드와 중복
- **해결 방법**: 기존 코드 확인 후 HandleDataMessage 함수만 수정하여 ACK 응답 기능 추가 - 해결 완료

## 다음 구현 계획

1. **고급 메시지 시퀀스 관리 구현**
   - 순서 보장 알고리즘 구현
   - 누락된 메시지 감지 및 요청 시스템 완성
   - 시퀀스 윈도우 관리 메커니즘 개발
   
2. **중복 메시지 처리 구현**
   - 중복 감지 로직 구현
   - 메시지 캐싱 메커니즘 개발
   - 멱등성 보장 처리 기능 구현
   
3. **통합 테스트 및 최적화**
   - 신뢰성 있는 메시지 전달 시스템 성능 테스트
   - 높은 부하 상황에서의 동작 검증
   - 네트워크 상태 평가 알고리즘 정확도 검증